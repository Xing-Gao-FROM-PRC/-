import datetime
import random

# 定义八卦数字
bagua_num = {
    "乾": 1, "兑": 2, "离": 3, "震": 4, "巽": 5, "坎": 6, "艮": 7, "坤": 8
}

# 定义十二时辰时间段
shichen = {
    "子": "23:00-01:00", "丑": "01:00-03:00", "寅": "03:00-05:00", "卯": "05:00-07:00",
    "辰": "07:00-09:00", "巳": "09:00-11:00", "午": "11:00-13:00", "未": "13:00-15:00",
    "申": "15:00-17:00", "酉": "17:00-19:00", "戌": "19:00-21:00", "亥": "21:00-23:00"
}

# 定义十二时辰的数字
shichen_num = {
    "子": 1, "丑": 2, "寅": 3, "卯": 4, "辰": 5, "巳": 6, "午": 7, "未": 8, "申": 9, "酉": 10, "戌": 11, "亥": 12
}

# 定义六十四卦
baguaguaxiang = {
    "11":"乾为天：乾卦：刚健中正",
    "12":"天泽履：履卦：脚踏实地",
    "13":"天火同人：同人卦：上下和同",
    "14":"天雷无妄：无妄卦：无妄而得",
    "15":"天风姤：姤卦：天下有风",
    "16":"天水讼：讼卦：慎争戒讼",
    "17":"天山遁：遁卦：遁世救世",
    "18":"天地否：否卦：不交不通",
    "21":"泽天夬：夬卦：决而能和",
    "22":"兑为泽：兑卦：刚内柔外",
    "23":"泽火革：革卦：顺天应人",
    "24":"泽雷随：随卦：随时变通",
    "25":"泽风大过：大过卦：非常行动",
    "26":"泽水困：困卦：困境求通",
    "27":"泽山咸：咸卦：相互感应",
    "28":"泽地萃：萃卦：荟萃聚集",
    "31":"火天大有：大有卦：顺天依时",
    "32":"火泽睽：睽卦：异中求同",
    "33":"离卦：离为火：附和依托",
    "34":"火雷噬嗑：噬嗑卦：刚柔相济",
    "35":"火风鼎：鼎卦：稳重图变",
    "36":"火水未济:未济卦：事业未竟",
    "37":"火山旅：旅卦：依义顺时",
    "38":"地火晋：晋卦：求进发展",
    "41":"雷天大壮：大壮卦：状勿妄动",
    "42":"雷泽归妹：归妹卦：立家兴业",
    "43":"雷火丰：丰卦：日中则斜",
    "44":"震为雷：震卦：临危不乱",
    "45":"雷风恒：恒卦：恒心有成",
    "46":"雷水解：解卦：柔道致治",
    "47":"雷山小过：小过卦：行动有度",
    "48":"雷地豫：豫卦：顺时依势",
    "51":"风天小畜：小畜卦：蓄养待进",
    "52":"风泽中孚：中孚卦：诚信立身",
    "53":"风火家人：家人卦：诚威治业",
    "54":"风雷益：益卦：损上益下",
    "55":"巽为风：巽卦：谦逊受益",
    "56":"风水涣：涣卦：拯救涣散",
    "57":"风山渐：渐卦：渐进蓄德",
    "58":"风地观：观卦：观下瞻上",
    "61":"水天需：需卦：守正待机",
    "62":"水泽节：节卦：万物有节",
    "63":"水火既济：既济卦：盛极将衰",
    "64":"水雷屯：屯卦：起始维艰",
    "65":"水风井：井卦：求贤若渴",
    "66":"坎为水：坎卦：行险用险",
    "67":"水山蹇: 蹇卦：险阻在前",
    "68":"水地比：比卦：诚信团结",
    "71":"山天大畜：大畜卦：止而不止",
    "72":"山泽损：损卦：损益制衡",
    "73":"山火贲: 贲卦：饰外扬质",
    "74":"山雷颐: 颐卦：纯正以养",
    "75":"山风蛊：蛊卦：振疲起衰",
    "76":"山水蒙：蒙卦：启蒙奋发",
    "77":"艮为山：艮卦：动静适时",
    "78":"山地剥：剥卦：顺势而止",
    "81":"地天泰：泰卦：应时而变",
    "82":"地泽临：临卦：教民保民",
    "83":"地火明夷：明夷卦：晦而转明",
    "84":"地雷复：复卦：寓动于顺",
    "85":"地风升：升卦：柔顺谦虚",
    "86":"地水师：师卦：行险而顺",
    "87":"地山谦：谦卦：内高外低",
    "88":"坤为地：坤卦：柔顺伸展",
}

def get_current_shichen():
    curr_time = datetime.datetime.now().strftime('%H:%M:%S')
    for key, value in shichen.items():
        if value.split('-')[0] <= curr_time <= value.split('-')[1]:
            return key

def generate_random_gua():
    return random.choice(list(bagua_num.values()))

def change_gua_part(part, value):
    mapping = {
        1: [5, 6, 7, 8, 1, 2, 3, 4],
        2: [3, 4, 1, 2, 7, 8, 5, 6],
        3: [2, 1, 4, 3, 6, 5, 8, 7],  # 添加两个额外的值，确保列表长度为8
        4: [5, 6, 7, 8, 1, 2, 3, 4],
        5: [3, 4, 1, 2, 7, 8, 5, 6],
        6: [2, 1, 4, 3, 6, 5, 8, 7],  # 添加两个额外的值，确保列表长度为8
    }

    # Ensure that the value is within the valid range
    value = value if 1 <= value <= 8 else 1
    
    return mapping[part][value - 1]



def qigua():
    up = generate_random_gua()  # 上卦
    down = generate_random_gua()  # 下卦

    print("上卦是：" + list(bagua_num.keys())[list(bagua_num.values()).index(up)])
    print("下卦是：" + list(bagua_num.keys())[list(bagua_num.values()).index(down)])

    gua = str(up) + str(down)
    print("原卦是：" + baguaguaxiang.get(gua, "未定义"))

    change_num = up + down + shichen_num[shichen_key]

    change_part = change_num % 6 or 6
    print("变爻位置：" + str(change_part))

    down = change_gua_part(change_part, down)

    gua = str(up) + str(down)
    print("变卦是：" + baguaguaxiang.get(gua, "未定义"))

if __name__ == "__main__":
    shichen_key = get_current_shichen()
    print("当前时辰是：" + shichen_key + "时")
    qigua_num = int(input("输入起卦数量："))
    
    for i in range(qigua_num):
        print("第" + str(i + 1) + "次起卦")
        qigua()
